(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-445743a4"],{"10dd":function(t,e,a){"use strict";var n=a("c078"),r=a.n(n);r.a},"383f":function(t,e,a){"use strict";a.d(e,"m",(function(){return r})),a.d(e,"q",(function(){return s})),a.d(e,"e",(function(){return i})),a.d(e,"a",(function(){return l})),a.d(e,"d",(function(){return o})),a.d(e,"b",(function(){return c})),a.d(e,"s",(function(){return d})),a.d(e,"w",(function(){return u})),a.d(e,"r",(function(){return g})),a.d(e,"y",(function(){return p})),a.d(e,"z",(function(){return _})),a.d(e,"x",(function(){return m})),a.d(e,"o",(function(){return f})),a.d(e,"A",(function(){return h})),a.d(e,"c",(function(){return k})),a.d(e,"p",(function(){return v})),a.d(e,"n",(function(){return b})),a.d(e,"t",(function(){return y})),a.d(e,"v",(function(){return w})),a.d(e,"u",(function(){return x})),a.d(e,"j",(function(){return T})),a.d(e,"f",(function(){return O})),a.d(e,"k",(function(){return j})),a.d(e,"g",(function(){return L})),a.d(e,"i",(function(){return C})),a.d(e,"h",(function(){return S})),a.d(e,"l",(function(){return D}));var n=a("b775");function r(t){return Object(n["a"])({url:"/saltstack/salt-minion/1/",method:"get",params:t})}function s(t){return Object(n["a"])({url:"/saltstack/salt-key/",method:"get",params:t})}function i(){return Object(n["a"])({url:"/saltstack/salt-key/",method:"post",data:{salt_key_tag:"global_flush_salt_key"}})}function l(t){return Object(n["a"])({url:"/saltstack/salt-key-opt/accept/",method:"post",data:{salt_key_tag:"accept_salt_key",minion_id:t}})}function o(t){return Object(n["a"])({url:"/saltstack/salt-key-opt/delete/",method:"post",data:{salt_key_tag:"delete_salt_key",minion_id:t}})}function c(t){return Object(n["a"])({url:"/saltstack/salt-key-opt/del-denied/",method:"post",data:{salt_key_tag:"delete_denied_salt_key",minion_id:t}})}function d(t){return Object(n["a"])({url:"/saltstack/salt-key-opt/reject/",method:"post",data:{salt_key_tag:"reject_salt_key",minion_id:t}})}function u(t){return Object(n["a"])({url:"/saltstack/salt-key/"+t+"/",method:"get"})}function g(t){return Object(n["a"])({url:"/saltstack/salt-minion/",method:"get",params:t})}function p(){return Object(n["a"])({url:"/saltstack/salt-minion/",method:"post",data:{salt_minion_tag:"global_update_salt_minion_list"}})}function _(){return Object(n["a"])({url:"/saltstack/salt-minion-opt/status-update/",method:"post",data:{salt_minion_tag:"global_update_salt_minion_status"}})}function m(t){return Object(n["a"])({url:"/saltstack/salt-minion-opt/update/",method:"post",data:{salt_minion_tag:"update_salt_minion",minion_id:t}})}function f(t){return Object(n["a"])({url:"/saltstack/salt-cmd/",method:"get",params:t})}function h(t){return Object(n["a"])({url:"/saltstack/salt-cmd/",method:"post",data:{salt_cmd_tag:"collection_info",collection_style:t.collection_style,minions:t.minions}})}function k(){return Object(n["a"])({url:"/saltstack/salt-cmd-opt/delete/",method:"post",data:{salt_cmd_tag:"salt_cmd_delete"}})}function v(t){return Object(n["a"])({url:"/saltstack/salt-cmd-opt/get-module/",method:"get",params:{salt_cmd_type:t}})}function b(t,e){return Object(n["a"])({url:"/saltstack/salt-cmd-opt/get-cmd/",method:"get",params:{salt_cmd_type:t,salt_cmd_module:e}})}function y(t){return Object(n["a"])({url:"/saltstack/salt-exe/",method:"post",data:t})}function w(t){return Object(n["a"])({url:"/saltstack/salt-tool/job-search/status/",method:"post",data:t})}function x(t){return Object(n["a"])({url:"/saltstack/salt-tool/job-search/result/",method:"post",data:t})}function T(t){return Object(n["a"])({url:"/saltstack/file-manage/file-tree/",method:"post",data:t})}function O(t){return Object(n["a"])({url:"/saltstack/file-manage/file-content/",method:"post",data:t})}function j(t){return Object(n["a"])({url:"/saltstack/file-manage/file-update/",method:"post",data:t})}function L(t){return Object(n["a"])({url:"/saltstack/file-manage/file-create/",method:"post",data:t})}function C(t){return Object(n["a"])({url:"/saltstack/file-manage/file-rename/",method:"post",data:t})}function S(t){return Object(n["a"])({url:"/saltstack/file-manage/file-delete/",method:"post",data:t})}function D(t){return Object(n["a"])({url:"/saltstack/file-manage/file-upload/",method:"post",data:t})}},c078:function(t,e,a){},c2e7:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.allLoading,expression:"allLoading"}],staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-row",{},[a("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"small"},on:{click:t.handleAddTaskDailog}},[t._v("新增Task")]),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"small",loading:t.exeLoading},on:{click:t.handleRunTask}},[t._v("执行Task")]),t._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.search,callback:function(e){t.$set(t.listQuery,"search",e)},expression:"listQuery.search"}}),t._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.data_list,size:"medium",border:"",fit:"","highlight-current-row":""},on:{"sort-change":t.sortChange,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{label:"ID",prop:"id",sortable:"custom",align:"center","min-width":"40"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.id))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"任务名称",prop:"name",sortable:"custom",align:"center","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"启用状态",align:"center","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{directives:[{name:"show",rawName:"v-show",value:e.row.enabled,expression:"scope.row.enabled"}],staticClass:"el-icon-success",staticStyle:{color:"#67c23a"}}),t._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:!e.row.enabled,expression:"!scope.row.enabled"}],staticClass:"el-icon-error",staticStyle:{color:"#ff4949"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"执行次数",align:"center","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.total_run_count))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"最近执行时间",align:"center","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.last_run_at?a("span",[t._v(t._s(t._f("parseTime")(e.row.last_run_at,"{y}-{m}-{d} {h}:{i}")))]):t._e(),t._v(" "),a("span")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},nativeOn:{click:function(a){return t.handUpdateTaskDailog(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handTaskLogDailog(e.row)}}},[t._v("日志")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.handleDeleteTask(e)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,page_size:t.listQuery.page_size},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:page_size":function(e){return t.$set(t.listQuery,"page_size",e)},pagination:t.getList}}),t._v(" "),a("el-dialog",{staticClass:"TaskForm",attrs:{title:t.dialogTaskFormTitle,width:"1220px",visible:t.dialogTaskFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogTaskFormVisible=e}}},[a("div",[a("el-form",{ref:"taskForm",staticStyle:{width:"1175px",margin:"0"},attrs:{rules:t.rules,model:t.task,"label-position":"right","label-width":"130px"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务名称：",prop:"name",error:t.name_error}},[a("el-input",{ref:"task_name_focus",staticStyle:{width:"260px"},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务命令：",prop:"task"}},[a("el-radio-group",{model:{value:t.task.task,callback:function(e){t.$set(t.task,"task",e)},expression:"task.task"}},[a("el-radio",{attrs:{label:"命令"}},[t._v("Shell")])],1)],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"执行对象类型：",prop:"tgt_type"}},[a("el-row",[a("el-radio-group",{model:{value:t.task.tgt_type,callback:function(e){t.$set(t.task,"tgt_type",e)},expression:"task.tgt_type"}},[a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"any"}},[t._v("所有")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"minion_list"}},[t._v("Minion_ID")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"pcre"}},[t._v("Minion正则")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"custom_group"}},[t._v("自定义组")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"grain"}},[t._v("Grain")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"grain_pcre"}},[t._v("Grain正则")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-radio",{attrs:{label:"ip_address"}},[t._v("IP")])],1)],1)],1)],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"minion_list"==t.task.tgt_type,expression:"task.tgt_type=='minion_list'"}],staticClass:"is-required",attrs:{label:"执行对象：",prop:"minion_list",error:t.minion_transfer_error}},[a("el-transfer",{ref:"dataTransfer",attrs:{filterable:"","filter-placeholder":"搜索Minion ID",titles:["Minion ID选择","已选Minion ID"],data:t.minion_list,"target-order":"push"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.option;return a("span",{},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:n.label,placement:"right"}},[a("span",[t._v(t._s(n.label))])])],1)}}]),model:{value:t.task.minion_list,callback:function(e){t.$set(t.task,"minion_list",e)},expression:"task.minion_list"}})],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.tgt_type_lable[t.task.tgt_type],expression:"tgt_type_lable[task.tgt_type]"}],staticClass:"is-required",attrs:{label:"执行对象：",prop:"tgt"}},[a("el-input",{staticStyle:{width:"350px"},attrs:{placeholder:t.tgt_type_placeholder[t.task.tgt_type],clearable:""},model:{value:t.task.tgt,callback:function(e){t.$set(t.task,"tgt",e)},expression:"task.tgt"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"启用：",prop:"enabled"}},[a("el-switch",{model:{value:t.task.enabled,callback:function(e){t.$set(t.task,"enabled",e)},expression:"task.enabled"}}),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.task.enabled,expression:"!task.enabled"}],staticStyle:{"font-weight":"normal",color:"#3FB8AF","font-size":"13px","text-align":"left",padding:"7px 7px"}},[t._v("提示：禁用最近执行时间会清空，只有启用才会显示")])],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"命令：",prop:"execute_cmd"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.task.execute_cmd,callback:function(e){t.$set(t.task,"execute_cmd",e)},expression:"task.execute_cmd"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"只运行一次：",prop:"one_off"}},[a("el-switch",{model:{value:t.task.one_off,callback:function(e){t.$set(t.task,"one_off",e)},expression:"task.one_off"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"调度方式：",prop:"scheduler"}},[a("el-radio-group",{model:{value:t.task.scheduler,callback:function(e){t.$set(t.task,"scheduler",e)},expression:"task.scheduler"}},[a("el-radio",{attrs:{label:"Clocked"}},[t._v("Clocked")]),t._v(" "),a("el-radio",{attrs:{label:"Crontab"}},[t._v("Crontab")]),t._v(" "),a("el-radio",{attrs:{label:"Interval"}},[t._v("Interval")])],1)],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:t.task.scheduler+"：",prop:t.task.scheduler.toLowerCase(),error:t.scheduler_error}},[a("el-select",{directives:[{name:"show",rawName:"v-show",value:"Clocked"==t.task.scheduler,expression:"task.scheduler=='Clocked'"}],staticClass:"is-required",staticStyle:{width:"260px"},attrs:{placeholder:"请选择"},model:{value:t.task.clocked,callback:function(e){t.$set(t.task,"clocked",e)},expression:"task.clocked"}},t._l(t.clocked_list,(function(e){return a("el-option",{key:e.id,attrs:{label:t._f("parseTime")(e.clocked_time,"{y}-{m}-{d} {h}:{i}"),value:e.id}})})),1),t._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:"Crontab"==t.task.scheduler,expression:"task.scheduler=='Crontab'"}],staticClass:"is-required",staticStyle:{width:"350px"},attrs:{placeholder:"请选择"},model:{value:t.task.crontab,callback:function(e){t.$set(t.task,"crontab",e)},expression:"task.crontab"}},t._l(t.crontab_list,(function(t){return a("el-option",{key:t.id,attrs:{label:t.minute+" "+t.hour+" "+t.day_of_week+" "+t.day_of_month+" "+t.month_of_year+"(m/h/d/dM/MY) "+t.timezone,value:t.id}})})),1),t._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:"Interval"==t.task.scheduler,expression:"task.scheduler=='Interval'"}],staticClass:"is-required",staticStyle:{width:"260px"},attrs:{placeholder:"请选择"},model:{value:t.task.interval,callback:function(e){t.$set(t.task,"interval",e)},expression:"task.interval"}},t._l(t.interval_list,(function(t){return a("el-option",{key:t.id,attrs:{label:"every "+t.every+" "+t.period,value:t.id}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"描述：",prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.task.description,callback:function(e){t.$set(t.task,"description",e)},expression:"task.description"}})],1)],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.addLoading=!1,t.dialogTaskFormVisible=!1}}},[t._v("关闭")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"新增Task"==t.dialogTaskFormTitle,expression:"dialogTaskFormTitle=='新增Task'"}],attrs:{type:"primary",loading:t.addLoading},on:{click:t.handleAddTask}},[t._v("确 定")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"编辑Task"==t.dialogTaskFormTitle,expression:"dialogTaskFormTitle=='编辑Task'"}],attrs:{type:"primary",loading:t.updateLoading},on:{click:t.handleUpdateTask}},[t._v("更 新")])],1)]),t._v(" "),a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:t.dialogInfoVisible,width:"800px"},on:{"update:visible":function(e){t.dialogInfoVisible=e}}},[a("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[a("span",[t._v(t._s(t.logTitle+" 日志"))]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"560px"},attrs:{size:"small",type:"primary",loading:t.logLoading},on:{click:t.getLogList}},[t._v("刷新")])],1),t._v(" "),a("el-row",{staticStyle:{"padding-bottom":"10px"}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:8}},[a("span",{staticStyle:{"font-weight":"bold"}},[t._v("完成时间：")]),a("span",[t._v(t._s(t._f("parseTime")(t.logData.date_done,"{y}-{m}-{d} {h}:{i}")))])]),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:8}},[a("span",{staticStyle:{"font-weight":"bold"}},[t._v("任务状态：")]),a("span",[t._v(t._s(t.logData.status))])])],1),t._v(" "),a("el-row",[a("pre",{directives:[{name:"loading",rawName:"v-loading",value:t.logLoading,expression:"logLoading"}],staticClass:"taskLog_pre",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"loading...","element-loading-background":"rgba(0, 0, 0, 0.8)"},domProps:{innerHTML:t._s(t.logData.log)}}),t._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.logTotal>0,expression:"logTotal>0"}],staticStyle:{margin:"0",padding:"10px 16px 10px 16px"},attrs:{total:t.logTotal,page:t.logListQuery.page,page_size:t.logListQuery.page_size,layout:"total, prev, pager, next, jumper"},on:{"update:page":function(e){return t.$set(t.logListQuery,"page",e)},"update:page_size":function(e){return t.$set(t.logListQuery,"page_size",e)},pagination:t.getLogList}})],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogInfoVisible=!1}}},[t._v("确定")])],1)],1)],1)},r=[],s=(a("6b54"),a("7f7f"),a("b85c")),i=a("5530"),l=(a("ac6a"),a("96cf"),a("1da1")),o=a("5c83"),c=a("b199"),d=a("383f"),u=a("6724"),g=(a("ed08"),a("333d")),p=a("5c96"),_={id:"",name:"",task:"命令",enabled:!0,one_off:!1,interval:null,crontab:null,clocked:null,scheduler:"Clocked",execute_cmd:"",tgt:"",minion_list:[],tgt_type:"",description:""},m={name:"TaskTable",components:{Pagination:g["a"]},directives:{elDragDialog:o["a"],waves:u["a"]},data:function(){var t=this,e=function(e,a,n){"any"==t.task.tgt_type||a?n():"minion_list"!=t.task.tgt_type?n(new Error("请选择执行对象")):n()},a=function(t,e,a){e?a():a(new Error("请选择执行对象类型"))},n=function(e,a,n){"Clocked"==t.task.scheduler?a?n():t.scheduler_error="请选择调度Clocked":"Crontab"==t.task.scheduler?a?n():t.scheduler_error="请选择调度Crontab":"Interval"==t.task.scheduler?a?n():t.scheduler_error="请选择调度Interval":n()};return{task:Object.assign({},_),clocked_list:[],crontab_list:[],interval_list:[],dialogTaskFormVisible:!1,rules:{name:{required:!0,message:"不为空",trigger:"blur"},tgt_type:{validator:a,trigger:"change"},tgt:{validator:e,trigger:"change"},clocked:{validator:n,trigger:"change"},crontab:{validator:n,trigger:"change"},interval:{validator:n,trigger:"change"},execute_cmd:{required:!0,message:"不为空",trigger:"blur"}},listQuery:{page:1,page_size:10,ordering:""},allLoading:!1,addLoading:!1,updateLoading:!1,tableKey:0,data_list:null,total:0,multipleSelection:[],tgt_type:"",tgt_type_lable:{pcre:"Minion正则：",custom_group:"自定义组：",grain:"Grain：",grain_pcre:"Grain正则：",ip_address:"IP："},post_tgt_type:{any:"glob",minion_list:"list",grain:"grain",grain_pcre:"grain_pcre",ip_address:"ipcidr",pcre:"pcre"},get_tgt_type:{glob:"any",list:"minion_list",grain:"grain",grain_pcre:"grain_pcre",ipcidr:"ip_address",pcre:"pcre"},tgt_type_placeholder:{pcre:"正则匹配Minion id",custom_group:"自定义组功能开发中。。。：",grain:"例：os:CentOS 或os:Windows",grain_pcre:"例：os:Cent*",ip_address:"ip/ip段，例：192.168.1.1 or 192.168.1.0/24"},minion_list:[],minion_transfer_error:"",scheduler_error:"",dialogTaskFormTitle:"新增Task",listLoading:!0,name_error:"",logData:{},dialogInfoVisible:!1,logListQuery:{page:1,page_size:1,task_name:""},logTotal:0,logTitle:"",logLoading:!1,exeLoading:!1}},watch:{"task.tgt_type":{handler:function(t,e){0===this.minion_list.length&&"minion_list"===t&&"编辑Task"!=this.dialogTaskFormTitle&&this.getIdList()}},"task.minion_list":{handler:function(t,e){t.length>0&&(this.minion_transfer_error="")}},"task.clocked":{handler:function(t,e){"Clocked"==this.scheduler&&t.length>0&&(this.scheduler_error="")}},"task.crontab":{handler:function(t,e){"Crontab"==this.scheduler&&t.length>0&&(this.scheduler_error="")}},"task.interval":{handler:function(t,e){"Interval"==this.scheduler&&t.length>0&&(this.scheduler_error="")}}},created:function(){this.getList(),this.getClockedList(),this.getCrontabList(),this.getIntervalList()},methods:{getList:function(){var t=this;this.listLoading=!0,Object(c["p"])(this.listQuery).then((function(e){t.data_list=e.data.results,t.total=e.data.count,setTimeout((function(){t.listLoading=!1}),500)})).catch((function(e){t.listLoading=!1}))},getClockedList:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c["k"])();case 3:e=t.sent,this.clocked_list=e.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),p["Message"].error(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));function e(){return t.apply(this,arguments)}return e}(),getCrontabList:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c["m"])();case 3:e=t.sent,this.crontab_list=e.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),p["Message"].error(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));function e(){return t.apply(this,arguments)}return e}(),getIntervalList:function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c["o"])();case 3:e=t.sent,this.interval_list=e.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),p["Message"].error(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));function e(){return t.apply(this,arguments)}return e}(),getIdList:function(){var t=this;Object(d["m"])().then((function(e){var a=e.data.results;a.forEach((function(e,a){t.minion_list.push({label:e,key:e})}))})).catch((function(t){console.log("获取minion id字段列表"+t)}))},handleFilter:function(){this.listQuery.page=1,this.getList()},handleSelectionChange:function(t){this.multipleSelection=t},resetTemp:function(){this.minion_list=[],this.$refs["taskForm"].resetFields()},handleAddTaskDailog:function(){var t=this;this.dialogTaskFormTitle,this.dialogTaskFormVisible=!0,this.$nextTick((function(){t.$refs["task_name_focus"].focus(),t.$refs.dataTransfer.clearQuery("left"),t.$refs.dataTransfer.clearQuery("right"),t.$refs["taskForm"].clearValidate(),t.minion_transfer_error="",t.scheduler_error="",t.name_error="",t.resetTemp()}))},handleAddTask:function(){var t=this;this.$refs["taskForm"].validate((function(e){if(!e)return!1;var a=Object(i["a"])({},t.task);if(a.enabled=a.enabled?1:0,a.one_off=a.one_off?1:0,"Clocked"==a.scheduler?(delete a.interval,delete a.crontab):"Interval"==a.scheduler?(delete a.clocked,delete a.crontab):"Crontab"==a.scheduler&&(delete a.clocked,delete a.interval),"minion_list"===a.tgt_type){if(!a.minion_list.length)return t.minion_transfer_error="请至少选择一个Minion ID",!1;a.tgt=[];var n,r=Object(s["a"])(a.minion_list);try{for(r.s();!(n=r.n()).done;){var l=n.value;a.tgt.push(l)}}catch(o){r.e(o)}finally{r.f()}}else"any"===a.tgt_type&&(a.tgt="*");a.tgt_type=t.post_tgt_type[a.tgt_type],a.kwargs=JSON.stringify({periodic_name:a.name,tgt:a.tgt,tgt_type:a.tgt_type,execute_cmd:a.execute_cmd}),t.minion_transfer_error="",t.scheduler_error="",t.name_error="",t.addLoading=!0,Object(c["d"])(a).then((function(e){if(e.data.status)t.addLoading=!1,t.dialogTaskFormVisible=!1,p["Message"].success(e.data.results),t.getList();else{t.addLoading=!1;var a=e.data.results;if(console.log(JSON.stringify(a)),"[object Object]"===Object.prototype.toString.call(a))for(var n in a)t["".concat(n,"_error")]=a[n][0];else p["Message"].error(e.data.results)}})).catch((function(e){t.addLoading=!1}))}))},handUpdateTaskDailog:function(t){var e=this;this.dialogTaskFormTitle="编辑Task";var a=Object(i["a"])({},t);this.minion_transfer_error="",this.scheduler_error="",this.name_error="",this.dialogTaskFormVisible=!0,this.$nextTick((function(){a.kwargs=JSON.parse(a.kwargs),a.tgt_type=e.get_tgt_type[a.kwargs.tgt_type],"any"==a.tgt_type?a.tgt="":"minion_list"==a.tgt_type?(a.minion_list=a.kwargs.tgt,a.tgt=""):(a.minion_list=[],a.tgt=a.kwargs.tgt),a.execute_cmd=a.kwargs.execute_cmd,a.enabled=!!a.enabled,a.one_off=!!a.one_off,a.clocked?a.scheduler="Clocked":a.interval?a.scheduler="Interval":a.crontab&&(a.scheduler="Crontab"),e.task=a,e.$refs.dataTransfer.clearQuery("left"),e.$refs.dataTransfer.clearQuery("right"),e.$refs["taskForm"].clearValidate();var t=e.task.minion_list;e.task.minion_list=[],Object(d["m"])().then((function(a){var n=a.data.results;n.forEach((function(t,a){e.minion_list.push({label:t,key:t})})),e.task.minion_list=t})).catch((function(t){console.log("getMinionIdList"+t)}))}))},handleUpdateTask:function(){var t=this;this.$refs["taskForm"].validate((function(e){if(!e)return!1;var a=Object(i["a"])({},t.task);if(a.enabled=a.enabled?1:0,a.one_off=a.one_off?1:0,"Clocked"==a.scheduler?(a.interval=null,a.crontab=null):"Interval"==a.scheduler?(a.clocked=null,a.crontab=null):"Crontab"==a.scheduler&&(a.clocked=null,a.interval=null),"minion_list"===a.tgt_type){if(!a.minion_list.length)return t.minion_transfer_error="请至少选择一个Minion ID",!1;a.tgt=[];var n,r=Object(s["a"])(a.minion_list);try{for(r.s();!(n=r.n()).done;){var l=n.value;a.tgt.push(l)}}catch(o){r.e(o)}finally{r.f()}}else"any"===a.tgt_type&&(a.tgt="*");a.tgt_type=t.post_tgt_type[a.tgt_type],a.kwargs=JSON.stringify({periodic_name:a.name,tgt:a.tgt,tgt_type:a.tgt_type,execute_cmd:a.execute_cmd}),t.minion_transfer_error="",t.scheduler_error="",t.name_error="",t.updateLoading=!0,Object(c["t"])(a).then((function(e){if(e.data.status)t.updateLoading=!1,t.dialogTaskFormVisible=!1,p["Message"].success(e.data.results),t.getList();else{t.updateLoading=!1;var a=e.data.results;if(console.log(JSON.stringify(a)),"[object Object]"===Object.prototype.toString.call(a))for(var n in a)t["".concat(n,"_error")]=a[n][0];else p["Message"].error(e.data.results)}})).catch((function(e){t.updateLoading=!1}))}))},handleDeleteTask:function(t){var e=this,a=t.$index,n=t.row;this.$confirm("确认要删除该Task吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.prev=1,t.next=4,Object(c["h"])(n.id);case 4:e.$message({type:"success",message:"删除成功!"}),e.data_list.splice(a,1),e.getList(),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](1),e.listLoading=!1,console.log("删除Task"+t.t0),e.$message({type:"info",message:"删除Task"+t.t0});case 14:case"end":return t.stop()}}),t,null,[[1,9]])})))).catch((function(){e.$message({type:"info",message:"取消"})}))},handleRunTask:function(){var t=this;if(0===this.multipleSelection.length)p["Message"].error("未选择任何Task，请选择");else{this.exeLoading=!0;var e,a=[],n=Object(s["a"])(this.multipleSelection);try{for(n.s();!(e=n.n()).done;){var r=e.value;a.push(r.id)}}catch(l){n.e(l)}finally{n.f()}var i={};i.id_list=a,Object(c["s"])(i).then((function(e){if(e.data.status)p["Message"].success(e.data.results);else{var a=e.data.results;console.log(JSON.stringify(a)),p["Message"].error(JSON.stringify(a))}t.exeLoading=!1})).catch((function(e){t.exeLoading=!1}))}},sortChange:function(t){var e=t.prop,a=t.order;"id"===e?this.listQuery.ordering="ascending"===a?"id":"-id":"name"===e&&(this.listQuery.ordering="ascending"===a?"name":"-name"),this.handleFilter()},logFun:function(t,e){if(t)for(var a in t){var n=t[a];"[object Object]"===Object.prototype.toString.call(n)||"[object Array]"===Object.prototype.toString.call(n)?(this.logData.log=this.logData.log+"<p style='color: #3FB8AF;padding-left: "+25*e+"px;'>"+a+":</p>",this.logFun(n,e+1)):(this.logData.log=this.logData.log+"<p style='color: #3FB8AF;padding-left: "+25*e+"px;'>"+a+":</p>",this.logData.log=this.logData.log+"<p style='padding-left: "+25*(e+1)+"px;'>"+n+"</p>")}},getLogList:function(){var t=this;this.logLoading=!0,this.logData={},Object(c["q"])(this.logListQuery).then((function(e){if(t.logData=e.data.results[0],t.logTotal=e.data.count,t.logData.log="","[object String]"!==Object.prototype.toString.call(JSON.parse(t.logData.result))){var a=0,n=JSON.parse(t.logData.result);for(var r in n){var s=n[r];"[object Object]"===Object.prototype.toString.call(s)?(t.logData.log=t.logData.log+"<p style='color: #45ddd4;font-weight: bold;'>"+r+":</p>",t.logFun(s,a+1)):"[object Array]"===Object.prototype.toString.call(s)?(t.logData.log=t.logData.log+"<p style='color: #45ddd4;font-weight: bold;'>"+r+":</p>",t.logFun(s,a+1),t.logData.log=t.logData.log+"\n\n"):(t.logData.log=t.logData.log+"<p style='color: #3FB8AF;font-weight: bold;'>"+r+":</p>",t.logData.log=t.logData.log+"<p style='padding-left: 25px;'>"+s+"</p>",t.logData.log=t.logData.log+"\n\n")}}else t.logData.log="",t.logData.log=t.logData.log+"<p style='color: #bf0000;'>"+JSON.parse(t.logData.result)+"</p>";setTimeout((function(){t.logLoading=!1}),200)})).catch((function(e){console.log("任务日志查询"+e),t.logData.log="",t.logData.log=t.logData.log+"<p style='color: #bf0000;'>"+e+"</p>",setTimeout((function(){t.logLoading=!1}),200)}))},handTaskLogDailog:function(t){this.logListQuery.page=1,this.logListQuery.search=t.name,this.logTitle=t.name,this.getLogList(),this.dialogInfoVisible=!0}}},f=m,h=(a("10dd"),a("2877")),k=Object(h["a"])(f,n,r,!1,null,"0e8fc186",null);e["default"]=k.exports}}]);